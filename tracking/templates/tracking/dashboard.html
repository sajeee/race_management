{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Race Dashboard — {{ race.name }}</title>
  <link rel="stylesheet" href="{% static 'tracking/css/styles.css' %}">


  <!-- pin Leaflet version to avoid surprise breakage -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="" crossorigin=""/>
  <style>
  body { font-family: Arial, sans-serif; }
  #map { height: 80vh; }
  #leaderboard tbody tr[data-bib] {
    transition: background-color 0.4s;
  }
</style>
</head>
<body>
  <h1>{{ race.name }} — Live Dashboard</h1>
  <div style="display:flex; gap:16px;">
    <div id="map" style="flex:1"></div>
    <div style="width:360px">
      <h3>Leaderboard</h3>
<table id="leaderboard" style="width:100%;border-collapse:collapse">
  <thead>
  <tr>
    <th>#</th>
    <th>Bib</th>
    <th>Name</th>
    <th>Dist (m)</th>
    <th>Pace s/km</th>
    <th>Speed (km/h)</th>
    <th>Last Update</th>
  </tr>
</thead>

  <tbody id="leaderboard-body">
       <tr><td colspan="5">No runners yet</td></tr>
  </tbody>
</table>
    </div>
  </div>

  <!-- expose the race id (inline script). This must be BEFORE dashboard.js -->
  <script>
    // safe: only declare once, and use `window.RACE_ID` to avoid const redeclare errors
    window.RACE_ID = {{ race.id }};
   // const WS_PROTO = window.location.protocol === 'https:' ? 'wss' : 'ws';
  //  const WS_URL = `${WS_PROTO}://${window.location.host}/ws/race/${window.RACE_ID}/`;
  //  console.log('WS URL:', WS_URL);
  </script>

  <!-- Leaflet JS (ensure this loads before our dashboard.js) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="" crossorigin=""></script>

  <!-- our dashboard behavior -->

  <script src="{% static 'tracking/js/dashboard.js' %}"></script>



</body>
</html>
